import{a as q,m as I,r as u,o as O,b as l,f as t,J as g,v as C,j as r,T as V,t as v,N as i,L as m,O as p,V as S,F as P,q as B,x as $,M as z,_ as E,e as n,S as F}from"./uGLhbxAz.js";import{u as R}from"./Bi2hqfX8.js";import{u as J}from"./CncYjveM.js";import{r as A}from"./Bbk6pL7h.js";const G={class:"space-y-6"},H={class:"flex items-center justify-between"},K={class:"flex items-center space-x-4"},Q={key:0,class:"bg-blue-50 dark:bg-blue-900/50 border border-blue-200 dark:border-blue-700 rounded-md p-4"},W={key:1,class:"bg-blue-50 dark:bg-blue-900/50 border border-blue-200 dark:border-blue-700 rounded-md p-4"},X={key:2,class:"bg-green-50 dark:bg-green-900/50 border border-green-200 dark:border-green-700 rounded-md p-4"},Y={class:"flex"},Z={class:"ml-3"},ee={class:"text-sm font-medium text-green-800 dark:text-green-200"},te={key:3,class:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 rounded-md p-4"},re={class:"flex"},oe={class:"ml-3"},ae={class:"text-sm font-medium text-red-800 dark:text-red-200"},se={key:4,class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={class:"relative"},ne=["disabled"],ie={value:"",disabled:""},ue=["value"],me={key:0,class:"absolute right-3 top-1/2 transform -translate-y-1/2"},pe={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},ce={key:1,class:"mt-1 text-sm text-yellow-600 dark:text-yellow-400"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},be={class:"relative"},ye={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6"},xe={class:"flex justify-end space-x-4 pt-6 border-t border-gray-200 dark:border-gray-700"},ve=["disabled"],ke={key:0},we={key:1},Ce={__name:"[id]",setup(_e){const{getProject:T,updateProject:U}=R(),{getClients:M}=J(),D=q(),h=I(()=>D.params.id),b=u([]),c=u(!1),y=u(""),k=u(!1),x=u(""),a=u({name:"",client_id:"",description:"",category:"",amount:null,contact_date:"",start_date:"",expected_completion_date:"",completion_date:"",payment_date:"",status:"contacted"}),w=u(!1),f=u(""),_=u(""),L=async()=>{var d;if(h.value){k.value=!0,x.value="";try{const e=await T(h.value);if(e.success&&e.data){const s=e.data.data||e.data;a.value={name:s.name||"",client_id:s.client_id||"",description:s.description||"",category:s.category||"",amount:s.amount||null,contact_date:s.contact_date?new Date(s.contact_date).toISOString().split("T")[0]:"",start_date:s.start_date?new Date(s.start_date).toISOString().split("T")[0]:"",expected_completion_date:s.expected_completion_date?new Date(s.expected_completion_date).toISOString().split("T")[0]:"",completion_date:s.completion_date?new Date(s.completion_date).toISOString().split("T")[0]:"",payment_date:s.payment_date?new Date(s.payment_date).toISOString().split("T")[0]:"",status:s.status||"contacted"}}else x.value=((d=e.error)==null?void 0:d.message)||"載入專案資料失敗",f.value=x.value}catch(e){console.error("載入專案失敗:",e),x.value="載入專案資料時發生錯誤，請稍後再試",f.value=x.value}finally{k.value=!1}}},j=async()=>{var d;c.value=!0,y.value="";try{const e=await M({per_page:100});if(e.success&&e.data){const s=e.data;s.success&&s.data&&s.data.data?b.value=s.data.data||[]:(b.value=[],y.value=s.message||"載入業主資料失敗：格式錯誤")}else b.value=[],y.value=((d=e.error)==null?void 0:d.message)||"載入業主資料失敗"}catch(e){console.error("載入業主失敗:",e),b.value=[],y.value="載入業主資料時發生錯誤，請稍後再試"}finally{c.value=!1}},N=async()=>{try{w.value=!0,f.value="",_.value="";const d=await U(h.value,a.value);if(d&&d.data)_.value=d.message||"專案更新成功",setTimeout(async()=>{await F("/projects")},1500);else throw new Error("專案更新失敗")}catch(d){console.error("更新專案失敗:",d),f.value=d.message||"專案更新失敗，請稍後再試"}finally{w.value=!1}};return O(async()=>{await Promise.all([j(),L()])}),(d,e)=>{const s=E;return n(),l("div",G,[t("div",H,[t("div",K,[t("button",{onClick:e[0]||(e[0]=o=>d.$router.back()),class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[C(r(A),{class:"w-5 h-5"})]),e[13]||(e[13]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"編輯專案"),t("p",{class:"text-gray-600 dark:text-gray-300"},"修改專案記錄")],-1))])]),r(k)?(n(),l("div",Q,e[14]||(e[14]=[V('<div class="flex"><div class="flex-shrink-0"><div class="h-5 w-5 animate-spin rounded-full border-2 border-solid border-current border-r-transparent"></div></div><div class="ml-3"><p class="text-sm font-medium text-blue-800 dark:text-blue-200">正在載入專案資料...</p></div></div>',1)]))):g("",!0),r(c)?(n(),l("div",W,e[15]||(e[15]=[V('<div class="flex"><div class="flex-shrink-0"><div class="h-5 w-5 animate-spin rounded-full border-2 border-solid border-current border-r-transparent"></div></div><div class="ml-3"><p class="text-sm font-medium text-blue-800 dark:text-blue-200">正在載入業主列表...</p></div></div>',1)]))):g("",!0),r(_)?(n(),l("div",X,[t("div",Y,[e[16]||(e[16]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),t("div",Z,[t("p",ee,v(r(_)),1)])])])):g("",!0),r(f)?(n(),l("div",te,[t("div",re,[e[17]||(e[17]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",oe,[t("p",ae,v(r(f)),1)])])])):g("",!0),r(k)?g("",!0):(n(),l("div",se,[t("form",{onSubmit:z(N,["prevent"]),class:"p-6 space-y-6"},[t("div",null,[e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"基本資訊",-1)),t("div",de,[t("div",null,[e[18]||(e[18]=t("label",{for:"name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 專案名稱 "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=o=>r(a).name=o),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"請輸入專案名稱"},null,512),[[p,r(a).name]])]),t("div",null,[e[22]||(e[22]=t("label",{for:"client",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 業主 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",le,[i(t("select",{id:"client","onUpdate:modelValue":e[2]||(e[2]=o=>r(a).client_id=o),required:"",disabled:r(c),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed"},[t("option",ie,v(r(c)?"載入中...":"請選擇業主"),1),(n(!0),l(P,null,B(r(b),o=>(n(),l("option",{key:(o==null?void 0:o.id)||"empty",value:o==null?void 0:o.id},v((o==null?void 0:o.name)||"未知業主"),9,ue))),128))],8,ne),[[S,r(a).client_id]]),r(c)?(n(),l("div",me,e[19]||(e[19]=[t("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent",role:"status"},[t("span",{class:"sr-only"},"載入中...")],-1)]))):g("",!0)]),r(y)?(n(),l("p",pe,[m(v(r(y))+" ",1),t("button",{onClick:j,class:"ml-2 underline hover:no-underline"}," 重新載入 ")])):!r(c)&&r(b).length===0?(n(),l("p",ce,[e[21]||(e[21]=m(" 尚無業主資料，請先 ")),C(s,{to:"/clients/create",class:"underline hover:no-underline"},{default:$(()=>e[20]||(e[20]=[m(" 新增業主 ")])),_:1,__:[20]})])):g("",!0)])])]),t("div",null,[e[24]||(e[24]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 專案描述 ",-1)),i(t("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=o=>r(a).description=o),rows:"4",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"請描述專案內容..."},null,512),[[p,r(a).description]])]),t("div",ge,[t("div",null,[e[26]||(e[26]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 專案類別 "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{id:"category","onUpdate:modelValue":e[4]||(e[4]=o=>r(a).category=o),required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[25]||(e[25]=[V('<option value="">請選擇類別</option><option value="website">網站</option><option value="script">腳本</option><option value="server">伺服器</option><option value="custom">自訂</option>',5)]),512),[[S,r(a).category]])]),t("div",null,[e[28]||(e[28]=t("label",{for:"amount",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 專案金額 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",be,[e[27]||(e[27]=t("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400"}," NT$ ",-1)),i(t("input",{id:"amount","onUpdate:modelValue":e[5]||(e[5]=o=>r(a).amount=o),type:"number",min:"0",step:"1",required:"",class:"w-full pl-12 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"0"},null,512),[[p,r(a).amount,void 0,{number:!0}]])])])]),t("div",null,[e[34]||(e[34]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"日期資訊",-1)),t("div",ye,[t("div",null,[e[29]||(e[29]=t("label",{for:"contact_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 接洽日期 "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{id:"contact_date","onUpdate:modelValue":e[6]||(e[6]=o=>r(a).contact_date=o),type:"date",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).contact_date]])]),t("div",null,[e[30]||(e[30]=t("label",{for:"start_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 開始執行日期 ",-1)),i(t("input",{id:"start_date","onUpdate:modelValue":e[7]||(e[7]=o=>r(a).start_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).start_date]])]),t("div",null,[e[31]||(e[31]=t("label",{for:"expected_completion_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 預計完成日期 ",-1)),i(t("input",{id:"expected_completion_date","onUpdate:modelValue":e[8]||(e[8]=o=>r(a).expected_completion_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).expected_completion_date]])])]),t("div",fe,[t("div",null,[e[32]||(e[32]=t("label",{for:"completion_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 實際完成日期 ",-1)),i(t("input",{id:"completion_date","onUpdate:modelValue":e[9]||(e[9]=o=>r(a).completion_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).completion_date]])]),t("div",null,[e[33]||(e[33]=t("label",{for:"payment_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 收款日期 ",-1)),i(t("input",{id:"payment_date","onUpdate:modelValue":e[10]||(e[10]=o=>r(a).payment_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).payment_date]])])])]),t("div",null,[e[36]||(e[36]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 專案狀態 ",-1)),i(t("select",{id:"status","onUpdate:modelValue":e[11]||(e[11]=o=>r(a).status=o),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[35]||(e[35]=[t("option",{value:"contacted"},"已接洽",-1),t("option",{value:"in_progress"},"進行中",-1),t("option",{value:"completed"},"已完成",-1),t("option",{value:"paid"},"已收款",-1)]),512),[[S,r(a).status]])]),t("div",xe,[t("button",{type:"button",onClick:e[12]||(e[12]=o=>d.$router.back()),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 取消 "),t("button",{type:"submit",disabled:r(w),class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"},[r(w)?(n(),l("span",ke,"更新中...")):(n(),l("span",we,"更新專案"))],8,ve)])],32)]))])}}};export{Ce as default};
