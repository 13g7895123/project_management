import{a as U,r as c,o as L,b as d,f as t,v as b,j as a,t as M,N as u,L as v,O as y,F as $,q as N,M as S,e as l,V as T,T as B,X as j,S as D}from"./uGLhbxAz.js";import{u as E}from"./CncYjveM.js";import{r as F}from"./Bbk6pL7h.js";import{r as q}from"./1HAJYFd6.js";import{r as z}from"./CIDNGuzx.js";const I={class:"space-y-6"},O={class:"flex items-center space-x-4"},P={key:0,class:"text-center py-12"},R={key:1,class:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 rounded-md p-4"},W={class:"flex"},X={class:"ml-3"},A={class:"text-sm font-medium text-red-800 dark:text-red-200"},G={key:2,class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J={class:"flex justify-between items-center mb-4"},K={class:"space-y-4"},Q={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4"},Y=["onUpdate:modelValue"],Z=["onUpdate:modelValue"],ee={class:"flex items-center space-x-4"},te={class:"flex items-center"},re=["onUpdate:modelValue","onChange"],oe=["onClick","disabled"],ae={class:"flex justify-end space-x-4 pt-6 border-t border-gray-200 dark:border-gray-700"},se=["disabled"],de={key:0},le={key:1},ye={__name:"[id]",setup(ne){const{getClient:k,updateClient:h}=E(),f=U(),g=c(!0),m=c(null),p=c(!1),o=c({name:"",how_we_met:"",notes:"",contacts:[{type:"",value:"",is_primary:!0}]}),x=async()=>{var s;g.value=!0,m.value=null;try{const e=await k(f.params.id);if(e.success&&e.data){const r=e.data.data||e.data;o.value={name:r.name||"",how_we_met:r.how_we_met||"",notes:r.notes||"",contacts:r.contact_methods&&r.contact_methods.length>0?r.contact_methods.map(n=>({type:n.type,value:n.value,is_primary:n.is_primary})):[{type:"",value:"",is_primary:!0}]}}else m.value=((s=e.error)==null?void 0:s.message)||"載入業主資料失敗"}catch(e){console.error("Load client error:",e),m.value="載入業主資料時發生錯誤，請稍後再試"}finally{g.value=!1}},w=async()=>{var s;try{p.value=!0;const e=await h(f.params.id,o.value);e.success?await D("/clients"):alert(((s=e.error)==null?void 0:s.message)||"更新業主資料失敗")}catch(e){console.error("Update client error:",e),alert("更新業主資料時發生錯誤，請稍後再試")}finally{p.value=!1}},_=()=>{o.value.contacts.push({type:"",value:"",is_primary:!1})},C=s=>{if(o.value.contacts.length>1){const e=o.value.contacts[s];o.value.contacts.splice(s,1),e.is_primary&&o.value.contacts.length>0&&(o.value.contacts[0].is_primary=!0)}},V=s=>{o.value.contacts[s].is_primary&&o.value.contacts.forEach((e,r)=>{r!==s&&(e.is_primary=!1)})};return L(()=>{x()}),(s,e)=>(l(),d("div",I,[t("div",O,[t("button",{onClick:e[0]||(e[0]=r=>s.$router.back()),class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[b(a(F),{class:"w-5 h-5"})]),e[5]||(e[5]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"編輯業主"),t("p",{class:"text-gray-600 dark:text-gray-300"},"修改業主資料")],-1))]),a(g)?(l(),d("div",P,e[6]||(e[6]=[t("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[t("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"載入中...")],-1),t("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"正在載入業主資料...",-1)]))):a(m)?(l(),d("div",R,[t("div",W,[e[7]||(e[7]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",X,[t("p",A,M(a(m)),1),t("button",{onClick:x,class:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 underline"}," 重新載入 ")])])])):(l(),d("div",G,[t("form",{onSubmit:S(w,["prevent"]),class:"p-6 space-y-6"},[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"基本資訊",-1)),t("div",H,[t("div",null,[e[8]||(e[8]=t("label",{for:"name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[v(" 業主稱呼 "),t("span",{class:"text-red-500"},"*")],-1)),u(t("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=r=>a(o).name=r),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"請輸入業主稱呼"},null,512),[[y,a(o).name]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"how_we_met",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 認識方式 ",-1)),u(t("input",{id:"how_we_met","onUpdate:modelValue":e[2]||(e[2]=r=>a(o).how_we_met=r),type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"例如：朋友介紹、網路接洽..."},null,512),[[y,a(o).how_we_met]])])])]),t("div",null,[e[11]||(e[11]=t("label",{for:"notes",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 備註 ",-1)),u(t("textarea",{id:"notes","onUpdate:modelValue":e[3]||(e[3]=r=>a(o).notes=r),rows:"4",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"請輸入備註資訊..."},null,512),[[y,a(o).notes]])]),t("div",null,[t("div",J,[e[13]||(e[13]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"聯繫方式",-1)),t("button",{type:"button",onClick:_,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-900 dark:text-primary-300 dark:hover:bg-primary-800"},[b(a(q),{class:"w-4 h-4 mr-1"}),e[12]||(e[12]=v(" 新增聯繫方式 "))])]),t("div",K,[(l(!0),d($,null,N(a(o).contacts,(r,n)=>(l(),d("div",{key:n,class:"flex items-start space-x-4 p-4 border border-gray-200 dark:border-gray-700 rounded-md"},[t("div",Q,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 類型 ",-1)),u(t("select",{"onUpdate:modelValue":i=>r.type=i,class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-sm"},e[14]||(e[14]=[B('<option value="">請選擇</option><option value="phone">電話</option><option value="mobile">手機</option><option value="email">電子郵件</option><option value="line">LINE</option><option value="wechat">WeChat</option><option value="telegram">Telegram</option><option value="other">其他</option>',8)]),8,Y),[[T,r.type]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 聯繫資訊 ",-1)),u(t("input",{"onUpdate:modelValue":i=>r.value=i,type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-sm",placeholder:"請輸入聯繫資訊"},null,8,Z),[[y,r.value]])]),t("div",ee,[t("label",te,[u(t("input",{"onUpdate:modelValue":i=>r.is_primary=i,type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded",onChange:i=>V(n)},null,40,re),[[j,r.is_primary]]),e[17]||(e[17]=t("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},"主要聯繫方式",-1))])])]),t("button",{type:"button",onClick:i=>C(n),class:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",disabled:a(o).contacts.length<=1},[b(a(z),{class:"w-4 h-4"})],8,oe)]))),128))])]),t("div",ae,[t("button",{type:"button",onClick:e[4]||(e[4]=r=>s.$router.back()),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 取消 "),t("button",{type:"submit",disabled:a(p),class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"},[a(p)?(l(),d("span",de,"更新中...")):(l(),d("span",le,"更新業主"))],8,se)])],32)]))]))}};export{ye as default};
