import{u as $}from"./BBlAexZ1.js";import{d as E,s as F,o as A,g as N,c as O,h as V,b as u,p as z,e as c,f as e,r as b,w as W,i as Z,j as i,t as f,n as R,k as Y,l as q,m as H,F as j,q as S,v as I,x as B,y as L,z as G,A as J,B as M,C as K}from"./uGLhbxAz.js";const Q=Symbol.for("nuxt:client-only"),X=E({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(s,{slots:n,attrs:k}){const h=F(!1);A(()=>{h.value=!0});const g=N();return g&&(g._nuxtClientOnly=!0),z(Q,!0),()=>{var r;if(h.value){const l=(r=n.default)==null?void 0:r.call(n);return l&&l.length===1?[O(l[0],k)]:l}const m=n.fallback||n.placeholder;if(m)return V(m);const C=s.fallback||s.placeholder||"",o=s.fallbackTag||s.placeholderTag||"span";return u(o,k,C)}}});function ee(s,n){return c(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function te(s,n){return c(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const ae={class:"h-64"},se={key:0,class:"h-64 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center"},re={key:1,class:"h-64 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center"},ne={class:"text-center"},oe={class:"text-red-500 dark:text-red-400 text-sm"},le={__name:"RevenueChart",props:{revenueData:{type:Array,default:()=>[]}},setup(s){const n=s,k=b(null),h=b(null),g=b(!0),m=b(null),{formatChartCurrency:C}=$(),o=async()=>{if(g.value=!0,m.value=null,await R(),!k.value){m.value="Canvas element not found",g.value=!1;return}if(!n.revenueData||n.revenueData.length===0){m.value="暫無收入數據",g.value=!1;return}try{if(typeof window<"u"){const{$Chart:r}=Y();if(!r)throw new Error("Chart.js not available");h.value&&h.value.destroy();const l=k.value.getContext("2d"),w=n.revenueData.map(v=>v.month_name||v.month),_=n.revenueData.map(v=>v.revenue||0),D=n.revenueData.map(v=>v.expected_revenue||0);h.value=new r(l,{type:"line",data:{labels:w,datasets:[{label:"實際收入",data:_,borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.1)",tension:.1,fill:!0},{label:"預期收入",data:D,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",borderDash:[5,5],tension:.1,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(v){return C(v)}}}},elements:{point:{radius:4,hoverRadius:6}}}})}g.value=!1}catch(r){console.error("Error creating chart:",r),m.value="圖表載入失敗: "+r.message,g.value=!1}};return W(()=>n.revenueData,r=>{r&&r.length>0&&o()},{immediate:!0}),A(()=>{n.revenueData&&n.revenueData.length>0&&o()}),Z(()=>{h.value&&h.value.destroy()}),(r,l)=>(c(),u("div",ae,[i(g)?(c(),u("div",se,l[0]||(l[0]=[e("div",{class:"text-center"},[e("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[e("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"載入中...")]),e("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"載入收入趨勢...")],-1)]))):i(m)?(c(),u("div",re,[e("div",ne,[l[1]||(l[1]=e("svg",{class:"mx-auto h-12 w-12 text-red-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",oe,f(i(m)),1),e("button",{onClick:o,class:"mt-2 text-primary-600 hover:text-primary-700 text-sm underline"},"重試")])])):(c(),u("canvas",{key:2,ref_key:"chartCanvas",ref:k,class:"w-full h-full"},null,512))]))}},de=()=>{const{get:s}=q();return{getDashboardStats:async()=>await s("/dashboard/stats"),getRevenueStats:async(a="month",y={})=>await s(`/dashboard/revenue/${a}`,y),getProjectCountStats:async(a="month",y={})=>await s(`/dashboard/projects/${a}`,y),getClientStats:async(a={})=>await s("/dashboard/clients",a),getRecentActivities:async(a=10)=>await s("/dashboard/activities",{limit:a}),getUpcomingDeadlines:async(a=30)=>await s("/dashboard/deadlines",{days:a}),getMonthlyRevenueTrend:async(a=12)=>await s("/dashboard/revenue/trend",{months:a}),getProjectStatusDistribution:async()=>await s("/dashboard/projects/status-distribution"),getCategoryRevenueBreakdown:async(a="year")=>await s("/dashboard/revenue/by-category",{period:a}),getTopClientsByRevenue:async(a=10,y="year")=>await s("/dashboard/clients/top-revenue",{limit:a,period:y}),getDailyStats:async(a,y)=>await s("/dashboard/daily-stats",{start_date:a,end_date:y}),getWeeklyStats:async(a,y)=>await s("/dashboard/weekly-stats",{start_date:a,end_date:y}),getYearlyStats:async a=>await s("/dashboard/yearly-stats",{year:a})}},ie={class:"space-y-6"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},ue={class:"flex items-center"},ge={class:"p-3 rounded-lg bg-primary-100 dark:bg-primary-900"},pe={class:"ml-4"},me={class:"text-sm font-medium text-gray-600 dark:text-gray-400"},he={class:"text-2xl font-bold text-gray-900 dark:text-white"},ve={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ye={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},xe={key:0,class:"h-64 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center"},be={key:1,class:"h-64 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center"},fe={class:"text-center"},ke={class:"text-red-500 dark:text-red-400 text-sm"},we={key:2,class:"h-64"},_e={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},Ce={key:0,class:"space-y-4"},De={class:"flex-1"},Re={class:"text-sm text-gray-900 dark:text-white"},Ae={class:"text-xs text-gray-500 dark:text-gray-400"},je={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},Ie={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},Be={class:"text-2xl font-bold text-orange-600 dark:text-orange-400"},Me={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},$e={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},Te={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},Pe={class:"text-2xl font-bold text-red-600 dark:text-red-400"},Ue={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},Ee={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},Oe={__name:"index",setup(s){const{getDashboardStats:n,getRecentActivities:k,getMonthlyRevenueTrend:h}=de(),{formatTWD:g}=$(),m=b(!0),C=b(null),o=b({}),r=b([]),l=b(!0),w=b(null),_=b([]),D=H(()=>[{name:"總專案數",value:o.value.total_projects||0,icon:"FolderIcon"},{name:"已收入",value:g(o.value.total_revenue||0),icon:"CurrencyDollarIcon"},{name:"預期總收入",value:g(o.value.expected_revenue||0),icon:"ChartBarIcon"},{name:"進行中專案",value:o.value.in_progress_projects||0,icon:"ClockIcon"}]),v=async()=>{m.value=!0,C.value=null;try{const d=await n();if(d.success&&d.data){const x=d.data;x.success?o.value=x.data:o.value=x}else o.value={total_projects:15,total_revenue:15e4,in_progress_projects:3,total_clients:8};const t=await k(6);if(t.success&&t.data){const x=t.data;x.success&&Array.isArray(x.data)?r.value=x.data:Array.isArray(x)?r.value=x:(console.warn("Unexpected activities format, showing empty activities"),r.value=[])}else console.warn("Activities API failed, showing empty activities"),r.value=[]}catch(d){C.value=d.message||"載入數據失敗",console.error("Dashboard loading error:",d)}finally{m.value=!1}},a=async()=>{console.log("Starting loadRevenueChart"),l.value=!0,w.value=null;try{console.log("Calling getMonthlyRevenueTrend API");const d=await h();if(console.log("API response received:",d),d.success&&d.data){const t=d.data;t.success&&Array.isArray(t.data)||Array.isArray(t.data)?_.value=t.data:(console.warn("Unexpected API response format, showing empty chart"),_.value=[])}else console.warn("Revenue API failed, showing empty chart"),_.value=[];await R(),l.value=!1}catch(d){console.error("Chart loading error:",d),w.value=`載入收入趨勢失敗: ${d.message}`,l.value=!1}},y={UsersIcon:K,CurrencyDollarIcon:te,ChartBarIcon:M,ClockIcon:ee,FolderIcon:J},T=d=>y[d]||M,P=()=>{console.log("Retrying chart load"),w.value=null,a()};return A(async()=>{console.log("Dashboard component mounted"),await R(),await v(),console.log("Dashboard data loaded, starting chart load"),await a(),console.log("Chart load completed")}),(d,t)=>{const x=le,U=X;return c(),u("div",ie,[t[15]||(t[15]=e("div",{class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},[e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-4"}," 專案管理儀表板 "),e("p",{class:"text-gray-600 dark:text-gray-300"}," 管理您的專案、業主資訊，並追蹤專案進度和收入統計。 ")],-1)),e("div",ce,[(c(!0),u(j,null,S(i(D),p=>(c(),u("div",{key:p.name,class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},[e("div",ue,[e("div",ge,[(c(),L(G(T(p.icon)),{class:"w-6 h-6 text-primary-600 dark:text-primary-400"}))]),e("div",pe,[e("p",me,f(p.name),1),e("p",he,f(p.value),1)])])]))),128))]),e("div",ve,[e("div",ye,[t[3]||(t[3]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," 收入趨勢 ",-1)),i(l)?(c(),u("div",xe,t[0]||(t[0]=[e("div",{class:"text-center"},[e("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[e("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"載入中...")]),e("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"載入收入趨勢...")],-1)]))):i(w)?(c(),u("div",be,[e("div",fe,[t[1]||(t[1]=e("svg",{class:"mx-auto h-12 w-12 text-red-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",ke,f(i(w)),1),e("button",{onClick:P,class:"mt-2 text-primary-600 hover:text-primary-700 text-sm underline"},"重試")])])):(c(),u("div",we,[I(U,null,{fallback:B(()=>t[2]||(t[2]=[e("div",{class:"h-64 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center"},[e("div",{class:"text-center"},[e("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[e("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"載入中...")]),e("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"載入收入趨勢...")])],-1)])),default:B(()=>[I(x,{"revenue-data":i(_)},null,8,["revenue-data"])]),_:1})]))]),e("div",_e,[t[6]||(t[6]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," 專案動態 ",-1)),i(r)&&i(r).length>0?(c(),u("div",Ce,[(c(!0),u(j,null,S(i(r),p=>(c(),u("div",{key:(p==null?void 0:p.id)||"empty",class:"flex items-start space-x-3"},[t[4]||(t[4]=e("div",{class:"w-2 h-2 mt-2 bg-primary-500 rounded-full"},null,-1)),e("div",De,[e("p",Re,f((p==null?void 0:p.description)||"無描述"),1),e("p",Ae,f((p==null?void 0:p.time)||"未知時間"),1)])]))),128))])):(c(),u("div",je,t[5]||(t[5]=[e("svg",{class:"mx-auto h-12 w-12 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",null,"暫無專案動態",-1)])))])]),e("div",Se,[e("div",Ie,[t[7]||(t[7]=e("h4",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2"},"待收款項",-1)),e("p",Be,f(i(g)(i(o).pending_revenue||0)),1),t[8]||(t[8]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"已完成待收",-1))]),e("div",Me,[t[9]||(t[9]=e("h4",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2"},"潛在收入",-1)),e("p",$e,f(i(g)(i(o).potential_revenue||0)),1),t[10]||(t[10]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"進行中專案",-1))]),e("div",Te,[t[11]||(t[11]=e("h4",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2"},"逾期專案",-1)),e("p",Pe,f(i(o).overdue_projects||0),1),t[12]||(t[12]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"超過預期完成日",-1))]),e("div",Ue,[t[13]||(t[13]=e("h4",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2"},"即將到期",-1)),e("p",Ee,f(i(o).upcoming_deadlines||0),1),t[14]||(t[14]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"7天內到期",-1))])])])}}};export{Oe as default};
