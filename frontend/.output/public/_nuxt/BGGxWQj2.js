import{r as g,o as N,b as n,f as t,J as f,v as V,j as r,T as D,t as x,M as O,N as l,L as m,O as p,V as w,F as q,q as B,x as z,_ as A,e as i,S as $}from"./uGLhbxAz.js";import{u as F}from"./Bi2hqfX8.js";import{u as E}from"./CncYjveM.js";import{r as P}from"./Bbk6pL7h.js";const G={class:"space-y-6"},H={class:"flex items-center justify-between"},J={class:"flex items-center space-x-4"},R={key:0,class:"bg-blue-50 dark:bg-blue-900/50 border border-blue-200 dark:border-blue-700 rounded-md p-4"},W={key:1,class:"bg-green-50 dark:bg-green-900/50 border border-green-200 dark:border-green-700 rounded-md p-4"},K={class:"flex"},Q={class:"ml-3"},X={class:"text-sm font-medium text-green-800 dark:text-green-200"},Y={key:2,class:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 rounded-md p-4"},Z={class:"flex"},ee={class:"ml-3"},te={class:"text-sm font-medium text-red-800 dark:text-red-200"},re={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ae={class:"relative"},se=["disabled"],de={value:"",disabled:""},ne=["value"],le={key:0,class:"absolute right-3 top-1/2 transform -translate-y-1/2"},ie={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},ue={key:1,class:"mt-1 text-sm text-yellow-600 dark:text-yellow-400"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pe={class:"relative"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6"},be={class:"flex justify-end space-x-4 pt-6 border-t border-gray-200 dark:border-gray-700"},ye=["disabled"],fe={key:0},xe={key:1},Me={__name:"create",setup(ve){const{createProject:C}=F(),{getClients:U}=E(),d=g([]),c=g(!1),b=g(""),a=g({name:"",client_id:"",description:"",category:"",amount:null,contact_date:"",start_date:"",expected_completion_date:"",completion_date:"",payment_date:"",status:"contacted"}),v=g(!1),k=g(""),y=g(""),_=async()=>{var s;c.value=!0,b.value="";try{const e=await U({per_page:100});if(e.success&&e.data){const u=e.data;u.success&&u.data&&u.data.data?(d.value=u.data.data||[],console.log("Loaded clients:",d.value.length)):(d.value=[],b.value=u.message||"載入業主資料失敗：格式錯誤",console.error("Unexpected backend response structure:",u))}else d.value=[],b.value=((s=e.error)==null?void 0:s.message)||"載入業主資料失敗",console.error("API request failed:",e)}catch(e){console.error("載入業主失敗:",e),d.value=[],b.value="載入業主資料時發生錯誤，請稍後再試"}finally{c.value=!1}},L=async()=>{try{v.value=!0,k.value="",y.value="";const s=await C(a.value);if(s&&s.data)y.value=s.message||"專案建立成功",setTimeout(async()=>{await $("/projects")},1500);else throw new Error("專案建立失敗")}catch(s){console.error("儲存專案失敗:",s),k.value=s.message||"專案建立失敗，請稍後再試"}finally{v.value=!1}},h=[{name:"電商平台重構專案",description:"重新設計並開發電商平台，包含前後端系統、金流整合、會員系統等功能。預計使用 Vue.js + Laravel 技術棧。",category:"website",amount:12e4,status:"contacted"},{name:"自動化部署腳本開發",description:"開發 CI/CD 自動化部署腳本，包含 Docker 容器化、GitHub Actions 設定、監控告警系統等。",category:"script",amount:45e3,status:"in_progress"},{name:"雲端伺服器架設與維護",description:"在 AWS 上架設高可用性伺服器架構，包含負載平衡、資料庫叢集、備份策略規劃。",category:"server",amount:85e3,status:"completed"},{name:"企業內部管理系統",description:"開發客製化的企業內部管理系統，包含人事管理、財務報表、專案追蹤等模組。",category:"custom",amount:2e5,status:"paid"},{name:"行動 App 開發專案",description:"開發跨平台行動應用程式，支援 iOS 和 Android 系統，包含即時通訊、地圖整合、推播通知等功能。",category:"website",amount:18e4,status:"contacted"}],j=()=>{const s=h[Math.floor(Math.random()*h.length)],e=d.value&&d.value.length>0?d.value[Math.floor(Math.random()*d.value.length)]:null,u=new Date,o=new Date(u.getTime()-Math.random()*30*24*60*60*1e3),M=new Date(o.getTime()+Math.random()*14*24*60*60*1e3),S=new Date(M.getTime()+(Math.random()*60+30)*24*60*60*1e3),T=new Date(S.getTime()+(Math.random()*14-7)*24*60*60*1e3),I=new Date(T.getTime()+Math.random()*30*24*60*60*1e3);a.value={name:s.name,client_id:(e==null?void 0:e.id)||"",description:s.description,category:s.category,amount:s.amount,contact_date:o.toISOString().split("T")[0],start_date:s.status!=="contacted"?M.toISOString().split("T")[0]:"",expected_completion_date:s.status!=="contacted"?S.toISOString().split("T")[0]:"",completion_date:["completed","paid"].includes(s.status)?T.toISOString().split("T")[0]:"",payment_date:s.status==="paid"?I.toISOString().split("T")[0]:"",status:s.status},y.value="已填入測試資料，您可以直接提交或修改後提交",setTimeout(()=>{y.value=""},3e3)};return N(async()=>{const s=new Date().toISOString().split("T")[0];a.value.contact_date=s,await _()}),(s,e)=>{const u=A;return i(),n("div",G,[t("div",H,[t("div",J,[t("button",{onClick:e[0]||(e[0]=o=>s.$router.back()),class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[V(r(P),{class:"w-5 h-5"})]),e[13]||(e[13]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"新增專案"),t("p",{class:"text-gray-600 dark:text-gray-300"},"建立新的專案記錄")],-1))]),t("button",{onClick:j,type:"button",class:"px-4 py-2 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-700 dark:text-blue-300 rounded-md text-sm font-medium transition-colors duration-200 flex items-center space-x-2",title:"填入測試資料"},e[14]||(e[14]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),t("span",null,"填入假資料",-1)]))]),r(c)?(i(),n("div",R,e[15]||(e[15]=[D('<div class="flex"><div class="flex-shrink-0"><div class="h-5 w-5 animate-spin rounded-full border-2 border-solid border-current border-r-transparent"></div></div><div class="ml-3"><p class="text-sm font-medium text-blue-800 dark:text-blue-200">正在載入業主列表...</p></div></div>',1)]))):f("",!0),r(y)?(i(),n("div",W,[t("div",K,[e[16]||(e[16]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),t("div",Q,[t("p",X,x(r(y)),1)])])])):f("",!0),r(k)?(i(),n("div",Y,[t("div",Z,[e[17]||(e[17]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",ee,[t("p",te,x(r(k)),1)])])])):f("",!0),t("div",re,[t("form",{onSubmit:O(L,["prevent"]),class:"p-6 space-y-6"},[t("div",null,[e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"基本資訊",-1)),t("div",oe,[t("div",null,[e[18]||(e[18]=t("label",{for:"name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 專案名稱 "),t("span",{class:"text-red-500"},"*")],-1)),l(t("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=o=>r(a).name=o),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"請輸入專案名稱"},null,512),[[p,r(a).name]])]),t("div",null,[e[22]||(e[22]=t("label",{for:"client",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 業主 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ae,[l(t("select",{id:"client","onUpdate:modelValue":e[2]||(e[2]=o=>r(a).client_id=o),required:"",disabled:r(c),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed"},[t("option",de,x(r(c)?"載入中...":"請選擇業主"),1),(i(!0),n(q,null,B(r(d),o=>(i(),n("option",{key:(o==null?void 0:o.id)||"empty",value:o==null?void 0:o.id},x((o==null?void 0:o.name)||"未知業主"),9,ne))),128))],8,se),[[w,r(a).client_id]]),r(c)?(i(),n("div",le,e[19]||(e[19]=[t("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent",role:"status"},[t("span",{class:"sr-only"},"載入中...")],-1)]))):f("",!0)]),r(b)?(i(),n("p",ie,[m(x(r(b))+" ",1),t("button",{onClick:_,class:"ml-2 underline hover:no-underline"}," 重新載入 ")])):!r(c)&&r(d).length===0?(i(),n("p",ue,[e[21]||(e[21]=m(" 尚無業主資料，請先 ")),V(u,{to:"/clients/create",class:"underline hover:no-underline"},{default:z(()=>e[20]||(e[20]=[m(" 新增業主 ")])),_:1,__:[20]})])):f("",!0)])])]),t("div",null,[e[24]||(e[24]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 專案描述 ",-1)),l(t("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=o=>r(a).description=o),rows:"4",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"請描述專案內容..."},null,512),[[p,r(a).description]])]),t("div",me,[t("div",null,[e[26]||(e[26]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 專案類別 "),t("span",{class:"text-red-500"},"*")],-1)),l(t("select",{id:"category","onUpdate:modelValue":e[4]||(e[4]=o=>r(a).category=o),required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[25]||(e[25]=[D('<option value="">請選擇類別</option><option value="website">網站</option><option value="script">腳本</option><option value="server">伺服器</option><option value="custom">自訂</option>',5)]),512),[[w,r(a).category]])]),t("div",null,[e[28]||(e[28]=t("label",{for:"amount",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 專案金額 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",pe,[e[27]||(e[27]=t("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400"}," NT$ ",-1)),l(t("input",{id:"amount","onUpdate:modelValue":e[5]||(e[5]=o=>r(a).amount=o),type:"number",min:"0",step:"1",required:"",class:"w-full pl-12 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"0"},null,512),[[p,r(a).amount,void 0,{number:!0}]])])])]),t("div",null,[e[34]||(e[34]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"日期資訊",-1)),t("div",ce,[t("div",null,[e[29]||(e[29]=t("label",{for:"contact_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" 接洽日期 "),t("span",{class:"text-red-500"},"*")],-1)),l(t("input",{id:"contact_date","onUpdate:modelValue":e[6]||(e[6]=o=>r(a).contact_date=o),type:"date",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).contact_date]])]),t("div",null,[e[30]||(e[30]=t("label",{for:"start_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 開始執行日期 ",-1)),l(t("input",{id:"start_date","onUpdate:modelValue":e[7]||(e[7]=o=>r(a).start_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).start_date]])]),t("div",null,[e[31]||(e[31]=t("label",{for:"expected_completion_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 預計完成日期 ",-1)),l(t("input",{id:"expected_completion_date","onUpdate:modelValue":e[8]||(e[8]=o=>r(a).expected_completion_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).expected_completion_date]])])]),t("div",ge,[t("div",null,[e[32]||(e[32]=t("label",{for:"completion_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 實際完成日期 ",-1)),l(t("input",{id:"completion_date","onUpdate:modelValue":e[9]||(e[9]=o=>r(a).completion_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).completion_date]])]),t("div",null,[e[33]||(e[33]=t("label",{for:"payment_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 收款日期 ",-1)),l(t("input",{id:"payment_date","onUpdate:modelValue":e[10]||(e[10]=o=>r(a).payment_date=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[p,r(a).payment_date]])])])]),t("div",null,[e[36]||(e[36]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 專案狀態 ",-1)),l(t("select",{id:"status","onUpdate:modelValue":e[11]||(e[11]=o=>r(a).status=o),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[35]||(e[35]=[t("option",{value:"contacted"},"已接洽",-1),t("option",{value:"in_progress"},"進行中",-1),t("option",{value:"completed"},"已完成",-1),t("option",{value:"paid"},"已收款",-1)]),512),[[w,r(a).status]])]),t("div",be,[t("button",{type:"button",onClick:e[12]||(e[12]=o=>s.$router.back()),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 取消 "),t("button",{type:"submit",disabled:r(v),class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"},[r(v)?(i(),n("span",fe,"儲存中...")):(i(),n("span",xe,"儲存專案"))],8,ye)])],32)])])}}};export{Me as default};
