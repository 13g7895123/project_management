import{r as i,m as K,o as O,a as Q,w as G,b as y,f as t,v as f,x as H,N as v,O as J,j as d,P as k,V as _,F as L,q as S,T as P,t as u,_ as X,e as m,L as Y,K as V,S as Z}from"./uGLhbxAz.js";import{u as j}from"./Bi2hqfX8.js";import{u as ee}from"./CncYjveM.js";import{u as te}from"./BBlAexZ1.js";import{r as ae}from"./1HAJYFd6.js";import{r as se}from"./BFCvA479.js";import{r as re}from"./CIDNGuzx.js";const de={class:"space-y-6"},oe={class:"flex justify-between items-center"},le={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},ne={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},ie=["value"],ue={key:0,class:"text-center py-12"},ge={key:1,class:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 rounded-md p-4"},xe={class:"flex"},ye={class:"ml-3"},me={class:"text-sm font-medium text-red-800 dark:text-red-200"},ce={key:2,class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm overflow-hidden"},pe={class:"overflow-x-auto"},be={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},fe={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},ve={class:"px-6 py-4 whitespace-nowrap"},ke={class:"text-sm font-medium text-gray-900 dark:text-white"},we={class:"text-sm text-gray-500 dark:text-gray-400"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},_e={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},Le={class:"px-6 py-4 whitespace-nowrap"},Se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Pe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ve={class:"flex justify-end space-x-2"},qe=["onClick"],De=["onClick","disabled"],Ue={__name:"index",setup(Ne){const{getProjects:q,deleteProject:D}=j(),{getClients:N}=ee(),{formatTWD:T}=te(),o=i([]),l=i(""),g=i(""),x=i(""),n=i(""),w=i(!1),c=i(null),p=i([]),C=i(!1),A=K(()=>o.value.filter(s=>{const a=s.name.toLowerCase().includes(l.value.toLowerCase())||s.description.toLowerCase().includes(l.value.toLowerCase()),r=!g.value||s.category===g.value,e=!x.value||s.status===x.value,b=!n.value||s.client_id&&s.client_id.toString()===n.value.toString();return a&&r&&e&&b})),h=async()=>{var s;w.value=!0,c.value=null;try{const a=await q({search:l.value,category:g.value,status:x.value,client_id:n.value});if(a.success&&a.data){const r=a.data;r.success&&r.data?Array.isArray(r.data.data)?o.value=r.data.data||[]:Array.isArray(r.data)?o.value=r.data||[]:(o.value=[],c.value="載入專案資料失敗：API回應格式不正確"):(o.value=[],c.value=r.message||"載入專案資料失敗：格式錯誤")}else o.value=[],c.value=((s=a.error)==null?void 0:s.message)||"載入專案資料失敗"}catch(a){console.error("Load projects error:",a),o.value=[],c.value="載入專案資料時發生錯誤，請稍後再試"}finally{w.value=!1}},M=()=>{l.value="",g.value="",x.value="",n.value="",h()},$=async s=>{var r;if(!confirm("確定要刪除此專案嗎？"))return;const a=await D(s);a.success?o.value=o.value.filter(e=>e.id!==s):alert(((r=a.error)==null?void 0:r.message)||"刪除失敗")},z=s=>({website:"網站",script:"腳本",server:"伺服器",custom:"自訂"})[s]||s,B=s=>({website:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",script:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",server:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",custom:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"})[s]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",R=s=>({contacted:"已接洽",in_progress:"進行中",completed:"已完成",paid:"已收款"})[s]||s,U=s=>({contacted:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",in_progress:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",completed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",paid:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200"})[s]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",F=s=>s?new Date(s).toLocaleDateString("zh-TW"):"未設定",W=s=>{s!=null&&s.id&&Z(`/projects/${s.id}`)},E=async()=>{C.value=!0;try{const s=await N({per_page:100});if(s.success&&s.data){const a=s.data;a.success&&a.data&&a.data.data?p.value=a.data.data||[]:p.value=[]}else p.value=[]}catch(s){console.error("載入業主失敗:",s),p.value=[]}finally{C.value=!1}};return O(async()=>{const s=Q();s.query.q&&(l.value=s.query.q),s.query.client_id&&(n.value=s.query.client_id),await E(),h()}),G([l,g,x,n],()=>{}),(s,a)=>{const r=X;return m(),y("div",de,[t("div",oe,[a[5]||(a[5]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"專案管理"),t("p",{class:"text-gray-600 dark:text-gray-300"},"管理所有專案資訊")],-1)),f(r,{to:"/projects/create",class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},{default:H(()=>[f(d(ae),{class:"w-4 h-4 mr-2"}),a[4]||(a[4]=Y(" 新增專案 "))]),_:1,__:[4]})]),t("div",le,[t("div",ne,[t("div",null,[a[6]||(a[6]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"搜尋專案",-1)),v(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>k(l)?l.value=e:null),type:"text",placeholder:"搜尋專案名稱...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[J,d(l)]])]),t("div",null,[a[8]||(a[8]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"業主",-1)),v(t("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>k(n)?n.value=e:null),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},[a[7]||(a[7]=t("option",{value:""},"全部業主",-1)),(m(!0),y(L,null,S(d(p),e=>(m(),y("option",{key:(e==null?void 0:e.id)||"empty",value:e==null?void 0:e.id},u((e==null?void 0:e.name)||"未知業主"),9,ie))),128))],512),[[_,d(n)]])]),t("div",null,[a[10]||(a[10]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"專案類別",-1)),v(t("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>k(g)?g.value=e:null),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},a[9]||(a[9]=[P('<option value="">全部類別</option><option value="website">網站</option><option value="script">腳本</option><option value="server">伺服器</option><option value="custom">自訂</option>',5)]),512),[[_,d(g)]])]),t("div",null,[a[12]||(a[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"專案狀態",-1)),v(t("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>k(x)?x.value=e:null),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},a[11]||(a[11]=[P('<option value="">全部狀態</option><option value="contacted">已接洽</option><option value="in_progress">進行中</option><option value="completed">已完成</option><option value="paid">已收款</option>',5)]),512),[[_,d(x)]])]),t("div",{class:"flex items-end"},[t("button",{onClick:M,class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 清除篩選 ")])])]),d(w)?(m(),y("div",ue,a[13]||(a[13]=[t("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[t("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"載入中...")],-1),t("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"正在載入專案資料...",-1)]))):d(c)?(m(),y("div",ge,[t("div",xe,[a[14]||(a[14]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",ye,[t("p",me,u(d(c)),1),t("button",{onClick:h,class:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 underline"}," 重新載入 ")])])])):(m(),y("div",ce,[t("div",pe,[t("table",be,[a[15]||(a[15]=t("thead",{class:"bg-gray-50 dark:bg-gray-900"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," 專案名稱 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," 業主 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," 類別 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," 金額 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," 狀態 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," 接洽日期 "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," 操作 ")])],-1)),t("tbody",fe,[(m(!0),y(L,null,S(d(A),e=>{var b;return m(),y("tr",{key:(e==null?void 0:e.id)||"empty",class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[t("td",ve,[t("div",null,[t("div",ke,u((e==null?void 0:e.name)||"未知專案"),1),t("div",we,u((e==null?void 0:e.description)||"無描述"),1)])]),t("td",he,u(((b=e==null?void 0:e.client)==null?void 0:b.name)||"未知業主"),1),t("td",_e,[t("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",B(e==null?void 0:e.category)])},u(z(e==null?void 0:e.category)),3)]),t("td",Ce,u(d(T)((e==null?void 0:e.amount)||0)),1),t("td",Le,[t("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",U(e==null?void 0:e.status)])},u(R(e==null?void 0:e.status)),3)]),t("td",Se,u(F(e==null?void 0:e.contact_date)),1),t("td",Pe,[t("div",Ve,[t("button",{onClick:I=>W(e),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400"},[f(d(se),{class:"w-4 h-4"})],8,qe),t("button",{onClick:I=>$(e==null?void 0:e.id),class:"text-red-600 hover:text-red-900 dark:text-red-400",disabled:!(e!=null&&e.id)},[f(d(re),{class:"w-4 h-4"})],8,De)])])])}),128))])])])]))])}}};export{Ue as default};
