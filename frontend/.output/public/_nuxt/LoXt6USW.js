import{b as n,e as d,f as e,r as f,m as N,o as A,w as z,J as g,v as y,x as H,N as S,O as T,j as o,P as F,t as u,F as b,q as C,_ as P,L as R,y as Z,z as q,C as E,S as J}from"./uGLhbxAz.js";import{u as O}from"./CncYjveM.js";import{r as Q}from"./1HAJYFd6.js";import{r as U}from"./BFCvA479.js";import{r as G}from"./CIDNGuzx.js";function w(v,h){return d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function I(v,h){return d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"})])}function K(v,h){return d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"})])}function L(v,h){return d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})])}const W={class:"space-y-6"},X={class:"flex justify-between items-center"},Y={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},re={key:0,class:"text-center py-12"},se={key:1,class:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 rounded-md p-4"},te={class:"flex"},ae={class:"ml-3"},oe={class:"text-sm font-medium text-red-800 dark:text-red-200"},de={key:2,class:"space-y-4"},ne={class:"text-sm text-gray-600 dark:text-gray-400"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},le={class:"flex justify-between items-start mb-4"},ue={class:"text-lg font-semibold text-gray-900 dark:text-white"},me={class:"text-sm text-gray-500 dark:text-gray-400"},ce={class:"flex space-x-2"},xe=["onClick"],ge=["onClick","disabled"],he={class:"space-y-2 mb-4"},pe={class:"space-y-1"},ye={class:"text-gray-600 dark:text-gray-300"},ve={class:"text-gray-900 dark:text-white"},fe={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200"},_e={class:"flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700"},ke={class:"text-sm text-gray-500 dark:text-gray-400"},we=["onClick","disabled"],be={key:0,class:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},Ce={class:"text-sm text-gray-600 dark:text-gray-300"},Le={key:3,class:"text-center py-12"},$e={class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},Me={class:"text-gray-500 dark:text-gray-400"},Ae={__name:"index",setup(v){const{getClients:h,deleteClient:$}=O(),m=f([]),i=f(""),p=f(!1),c=f(null),_=N(()=>i.value?m.value.filter(t=>{if(!t)return!1;const s=t.name?t.name.toLowerCase().includes(i.value.toLowerCase()):!1,l=t.how_we_met?t.how_we_met.toLowerCase().includes(i.value.toLowerCase()):!1,r=t.notes?t.notes.toLowerCase().includes(i.value.toLowerCase()):!1;return s||l||r}):m.value),k=async()=>{var t;p.value=!0,c.value=null;try{const s=await h({search:i.value});if(s.success&&s.data){const l=s.data;l.success&&l.data&&l.data.data?m.value=l.data.data||[]:(m.value=[],c.value=l.message||"載入業主資料失敗：格式錯誤")}else m.value=[],c.value=((t=s.error)==null?void 0:t.message)||"載入業主資料失敗"}catch(s){console.error("Load clients error:",s),m.value=[],c.value="載入業主資料時發生錯誤，請稍後再試"}finally{p.value=!1}},M=()=>{i.value="",k()},V=async t=>{var s,l,r;if(!t){alert("無效的業主ID");return}if(confirm("確定要刪除此業主嗎？此操作無法復原。"))try{const x=await $(t);if(x.success){m.value=m.value.filter(D=>D.id!==t);const a=((s=x.data)==null?void 0:s.message)||"業主刪除成功";alert(a)}else{const a=((l=x.error)==null?void 0:l.message)||((r=x.data)==null?void 0:r.message)||"刪除失敗";alert(a)}}catch(x){console.error("Delete client error:",x),alert("刪除業主時發生錯誤，請稍後再試")}},j=t=>({phone:L,email:K,line:w,wechat:w,telegram:w,mobile:I})[t]||L,B=t=>{if(!t){alert("無效的業主ID");return}J(`/projects?client_id=${t}`)};return A(()=>{k()}),z(i,()=>{}),(t,s)=>{const l=P;return d(),n("div",W,[e("div",X,[s[2]||(s[2]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"業主管理"),e("p",{class:"text-gray-600 dark:text-gray-300"},"管理所有業主資訊和聯繫方式")],-1)),y(l,{to:"/clients/create",class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},{default:H(()=>[y(o(Q),{class:"w-4 h-4 mr-2"}),s[1]||(s[1]=R(" 新增業主 "))]),_:1,__:[1]})]),e("div",Y,[e("div",ee,[e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"搜尋業主",-1)),S(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>F(i)?i.value=r:null),type:"text",placeholder:"搜尋業主名稱...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[T,o(i)]])]),e("div",{class:"flex items-end"},[e("button",{onClick:M,class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 清除搜尋 ")])])]),o(p)?(d(),n("div",re,s[4]||(s[4]=[e("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[e("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"載入中...")],-1),e("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"正在載入業主資料...",-1)]))):o(c)?(d(),n("div",se,[e("div",te,[s[5]||(s[5]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",ae,[e("p",oe,u(o(c)),1),e("button",{onClick:k,class:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 underline"}," 重新載入 ")])])])):g("",!0),!o(p)&&!o(c)?(d(),n("div",de,[e("p",ne," 顯示 "+u(o(_).length)+" 個業主 ",1),e("div",ie,[(d(!0),n(b,null,C(o(_),(r,x)=>(d(),n("div",{key:(r==null?void 0:r.id)||`client-${x}`,class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6 hover:shadow-md transition-shadow duration-200"},[e("div",le,[e("div",null,[e("h3",ue,u((r==null?void 0:r.name)||"未知業主"),1),e("p",me," 認識於 "+u((r==null?void 0:r.how_we_met)||"未記錄"),1)]),e("div",ce,[e("button",{onClick:a=>t.$router.push(`/clients/${r.id}`),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 p-1",title:"編輯業主"},[y(o(U),{class:"w-4 h-4"})],8,xe),e("button",{onClick:a=>V(r==null?void 0:r.id),class:"text-red-600 hover:text-red-900 dark:text-red-400 p-1",disabled:!(r!=null&&r.id)},[y(o(G),{class:"w-4 h-4"})],8,ge)])]),e("div",he,[s[6]||(s[6]=e("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聯繫方式",-1)),e("div",pe,[t.contact?(d(!0),n(b,{key:0},C((r==null?void 0:r.contact_methods)||[],a=>(d(),n("div",{key:(a==null?void 0:a.id)||"empty",class:"flex items-center space-x-2 text-sm"},[(d(),Z(q(j(a==null?void 0:a.type)),{class:"w-4 h-4 text-gray-400"})),e("span",ye,u((a==null?void 0:a.type)||"未知")+":",1),e("span",ve,u((a==null?void 0:a.value)||"未填寫"),1),a!=null&&a.is_primary?(d(),n("span",fe," 主要 ")):g("",!0)]))),128)):g("",!0)])]),e("div",_e,[e("span",ke," 相關專案: "+u((r==null?void 0:r.projects_count)||0)+" 個 ",1),e("button",{onClick:a=>B(r==null?void 0:r.id),class:"text-sm text-primary-600 hover:text-primary-900 dark:text-primary-400 hover:underline",disabled:!(r!=null&&r.id)}," 查看專案 ",8,we)]),r!=null&&r.notes?(d(),n("div",be,[s[7]||(s[7]=e("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"備註",-1)),e("p",Ce,u(r.notes),1)])):g("",!0)]))),128))])])):g("",!0),!o(p)&&!o(c)&&o(_).length===0?(d(),n("div",Le,[y(o(E),{class:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e("h3",$e,u(o(i)?"找不到符合條件的業主":"尚未新增任何業主"),1),e("p",Me,u(o(i)?"請嘗試其他搜尋條件":"開始建立您的第一個業主資料"),1)])):g("",!0)])}}};export{Ae as default};
