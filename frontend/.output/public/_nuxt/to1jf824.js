import{b as g,e as u,f as e,l as W,D as Z,E as G,r as p,m as H,w as X,o as Y,J as x,t as n,j as a,N as y,v as F,O as f,P as ee,L as te,F as re,q as ae,V as A,a1 as se,a2 as oe,K as z,C as de}from"./uGLhbxAz.js";import{r as ne}from"./1HAJYFd6.js";function le(w,i){return u(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const ie=()=>{const{get:w,post:i,put:v,patch:h,del:S}=W();return{getUsers:async(o={})=>{const d=new URLSearchParams;o.search&&d.append("search",o.search),o.role&&d.append("role",o.role),o.status&&d.append("status",o.status),o.page&&d.append("page",o.page),o.per_page&&d.append("per_page",o.per_page),o.sort&&d.append("sort",o.sort),o.order&&d.append("order",o.order);const $=d.toString(),m=$?`/users?${$}`:"/users";return await w(m)},getUser:async o=>await w(`/users/${o}`),createUser:async o=>await i("/users",o),updateUser:async(o,d)=>await v(`/users/${o}`,d),deleteUser:async o=>await S(`/users/${o}`),toggleUserStatus:async(o,d)=>await h(`/users/${o}/status`,{status:d}),changeUserPassword:async(o,d)=>await h(`/users/${o}/password`,d),restoreUser:async o=>await h(`/users/${o}/restore`),forceDeleteUser:async o=>await S(`/users/${o}/force`),getUserStats:async()=>await w("/users/stats")}},ce={class:"space-y-6"},ge={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},ue={class:"flex items-center justify-between mb-6"},pe={class:"text-2xl font-bold text-gray-900 dark:text-white"},ye={class:"flex items-center space-x-4"},me={class:"relative"},xe={key:0,class:"text-center py-12"},be={class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},fe={class:"text-gray-600 dark:text-gray-400"},ve={key:1,class:"overflow-x-auto"},ke={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},we={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},he={class:"px-6 py-4 whitespace-nowrap"},_e={class:"flex items-center"},Ue={class:"w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center"},$e={class:"ml-4"},Ce={class:"text-sm font-medium text-gray-900 dark:text-white"},Fe={class:"text-sm text-gray-500 dark:text-gray-400"},Se={key:0,class:"text-xs text-gray-400 dark:text-gray-500"},Ve={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},je={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},De={class:"flex items-center space-x-2"},qe=["onClick","disabled"],Me=["onClick"],Ne=["onClick","disabled"],Te={key:0,class:"text-center py-12"},Ae={class:"text-gray-500 dark:text-gray-400"},ze={key:1,class:"text-center py-12"},Be={key:2,class:"mt-6 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 pt-4"},Le={class:"text-sm text-gray-700 dark:text-gray-300"},Ie={class:"flex items-center space-x-2"},Re=["disabled"],Je={class:"text-sm text-gray-700 dark:text-gray-300"},Ke=["disabled"],Oe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Qe={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-xl max-w-md w-full p-6"},We={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},Ze={class:"space-y-4"},Ge={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},He={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},Xe={key:0},Ye={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},et={value:"user"},tt={value:"admin"},rt={class:"flex justify-end space-x-3 mt-6"},at={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},st={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto"},ot={class:"space-y-4"},dt={class:"flex justify-end space-x-3 mt-6"},it={__name:"users",setup(w){const{t:i}=Z(),v=G(),{getUsers:h,updateUser:S,deleteUser:P,toggleUserStatus:j,createUser:D}=ie(),k=p(""),_=p(!1),U=p(!1),l=p({}),c=p({name:"",username:"",email:"",password:"",password_confirmation:"",role:"user",status:"active"}),V=p([]),b=p(!1),o=p(null),d=p({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),$=p(1),m=async(s=1)=>{try{b.value=!0,o.value=null;const r=await h({search:k.value,page:s,per_page:15,sort:"-created_at"});if(r.success)V.value=r.data.data||[],d.value=r.data.pagination||{current_page:1,last_page:1,per_page:15,total:0,from:0,to:0},$.value=s;else throw new Error(r.message||"Failed to load users")}catch(r){o.value=r.message,console.error("Failed to load users:",r),V.value=[],d.value={current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}}finally{b.value=!1}},E=H(()=>V.value),q=async s=>{s>=1&&s<=d.value.last_page&&await m(s)},B=async()=>{d.value.current_page>1&&await q(d.value.current_page-1)},L=async()=>{d.value.current_page<d.value.last_page&&await q(d.value.current_page+1)};X(k,async()=>{$.value=1,await m(1)},{debounce:500});const I=s=>{if(!s)return"未曾登入";try{return new Date(s).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return console.error("Invalid date:",s),"日期格式錯誤"}},R=async s=>{if(s!=null&&s.id)try{const r=s.status==="active"?"inactive":"active",C=await j(s.id,r);if(C.success)await m();else throw new Error(C.message||"Failed to toggle user status")}catch(r){console.error("Failed to toggle user status:",r),alert("Failed to toggle user status: "+r.message)}},J=s=>{s&&(l.value={...s},_.value=!0)},K=async()=>{var s;if((s=l.value)!=null&&s.id)try{const r=await S(l.value.id,{name:l.value.name,username:l.value.username,email:l.value.email,role:l.value.role,phone:l.value.phone,bio:l.value.bio,company:l.value.company,position:l.value.position,location:l.value.location,website:l.value.website});if(r.success)_.value=!1,await m();else throw new Error(r.message||"Failed to update user")}catch(r){console.error("Failed to update user:",r),alert("Failed to update user: "+r.message)}},O=async()=>{try{const s=await D(c.value);if(s.success)U.value=!1,c.value={name:"",username:"",email:"",password:"",password_confirmation:"",role:"user",status:"active"},await m();else throw new Error(s.message||"Failed to create user")}catch(s){console.error("Failed to create user:",s),alert("Failed to create user: "+s.message)}},Q=async s=>{if(s!=null&&s.id&&confirm("確定要刪除這位用戶嗎？"))try{const r=await P(s.id);if(r.success)await m();else throw new Error(r.message||"Failed to delete user")}catch(r){console.error("Failed to delete user:",r),alert("Failed to delete user: "+r.message)}};return Y(async()=>{await m()}),(s,r)=>{var C;return u(),g("div",ce,[e("div",ge,[e("div",ue,[e("h2",pe,n(a(i)("nav.user_management")),1),e("div",ye,[e("div",me,[y(e("input",{"onUpdate:modelValue":r[0]||(r[0]=t=>ee(k)?k.value=t:null),type:"text",placeholder:"搜尋用戶...",class:"w-64 px-4 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(k)]]),F(a(se),{class:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]),e("button",{onClick:r[1]||(r[1]=t=>U.value=!0),class:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[F(a(ne),{class:"w-4 h-4 mr-2"}),r[15]||(r[15]=te(" 新增用戶 "))])])]),a(v).isAdmin?(u(),g("div",ve,[e("table",ke,[r[16]||(r[16]=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 tracking-wide"}," 用戶資訊 "),e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 tracking-wide"}," 角色權限 "),e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 tracking-wide"}," 帳號狀態 "),e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 tracking-wide"}," 最後登入時間 "),e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 tracking-wide"}," 操作功能 ")])],-1)),e("tbody",we,[(u(!0),g(re,null,ae(a(E),t=>{var M,N;return u(),g("tr",{key:t.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[e("td",he,[e("div",_e,[e("div",Ue,[F(a(le),{class:"w-8 h-8 text-gray-500 dark:text-gray-400"})]),e("div",$e,[e("div",Ce,n((t==null?void 0:t.name)||"未知用戶"),1),e("div",Fe,n((t==null?void 0:t.email)||"未設定Email"),1),t!=null&&t.username?(u(),g("div",Se,"@"+n(t.username),1)):x("",!0)])])]),e("td",Ve,[e("span",{class:z(["inline-flex px-3 py-1 text-sm font-medium rounded-full",{"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":(t==null?void 0:t.role)==="admin","bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":(t==null?void 0:t.role)==="user"}])},n((t==null?void 0:t.role)==="admin"?"管理員":"一般用戶"),3)]),e("td",Ee,[e("span",{class:z(["inline-flex px-3 py-1 text-sm font-medium rounded-full",{"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":(t==null?void 0:t.status)==="active","bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":(t==null?void 0:t.status)==="inactive","bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":(t==null?void 0:t.status)==="suspended"}])},n((t==null?void 0:t.status)==="active"?"正常使用":(t==null?void 0:t.status)==="suspended"?"已暫停":"已停用"),3)]),e("td",Pe,n(I(t==null?void 0:t.last_login_at)),1),e("td",je,[e("div",De,[(t==null?void 0:t.id)!==((M=a(v).user)==null?void 0:M.id)?(u(),g("button",{key:0,onClick:T=>R(t),class:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300 transition-colors duration-200",disabled:!(t!=null&&t.id)},n((t==null?void 0:t.status)==="active"?a(i)("auth.deactivate"):a(i)("auth.activate")),9,qe)):x("",!0),e("button",{onClick:T=>J(t),class:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200"},n(a(i)("common.edit")),9,Me),(t==null?void 0:t.id)!==((N=a(v).user)==null?void 0:N.id)?(u(),g("button",{key:1,onClick:T=>Q(t),class:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 transition-colors duration-200",disabled:!(t!=null&&t.id)}," 刪除 ",8,Ne)):x("",!0)])])])}),128))])]),!a(b)&&a(E).length===0?(u(),g("div",Te,[F(a(de),{class:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e("p",Ae,n(a(i)("auth.no_users_found")),1)])):x("",!0),a(b)?(u(),g("div",ze,r[17]||(r[17]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500 dark:text-gray-400"},"載入中...",-1)]))):x("",!0)])):(u(),g("div",xe,[F(a(oe),{class:"w-12 h-12 text-red-500 mx-auto mb-4"}),e("h3",be,n(a(i)("auth.access_denied")),1),e("p",fe,n(a(i)("auth.admin_only_feature")),1)])),!a(b)&&a(E).length>0&&a(d).last_page>1?(u(),g("div",Be,[e("div",Le," 顯示 "+n(a(d).from)+" 到 "+n(a(d).to)+" 筆，共 "+n(a(d).total)+" 筆用戶 ",1),e("div",Ie,[e("button",{onClick:r[2]||(r[2]=t=>B()),disabled:a(d).current_page<=1||a(b),class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"}," 上一頁 ",8,Re),e("span",Je," 第 "+n(a(d).current_page)+" 頁，共 "+n(a(d).last_page)+" 頁 ",1),e("button",{onClick:r[3]||(r[3]=t=>L()),disabled:a(d).current_page>=a(d).last_page||a(b),class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"}," 下一頁 ",8,Ke)])])):x("",!0)]),a(_)?(u(),g("div",Oe,[e("div",Qe,[e("h3",We,n(a(i)("auth.edit_user")),1),e("div",Ze,[e("div",null,[e("label",Ge,n(a(i)("auth.full_name")),1),y(e("input",{"onUpdate:modelValue":r[4]||(r[4]=t=>a(l).name=t),type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(l).name]])]),e("div",null,[e("label",He,n(a(i)("auth.email")),1),y(e("input",{"onUpdate:modelValue":r[5]||(r[5]=t=>a(l).email=t),type:"email",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(l).email]])]),a(l).id!==((C=a(v).user)==null?void 0:C.id)?(u(),g("div",Xe,[e("label",Ye,n(a(i)("auth.role")),1),y(e("select",{"onUpdate:modelValue":r[6]||(r[6]=t=>a(l).role=t),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},[e("option",et,n(a(i)("auth.role_user")),1),e("option",tt,n(a(i)("auth.role_admin")),1)],512),[[A,a(l).role]])])):x("",!0)]),e("div",rt,[e("button",{onClick:r[7]||(r[7]=t=>_.value=!1),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200"},n(a(i)("common.cancel")),1),e("button",{onClick:K,class:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200"},n(a(i)("common.save")),1)])])])):x("",!0),a(U)?(u(),g("div",at,[e("div",st,[r[25]||(r[25]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," 新增用戶 ",-1)),e("div",ot,[e("div",null,[r[18]||(r[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 姓名 * ",-1)),y(e("input",{"onUpdate:modelValue":r[8]||(r[8]=t=>a(c).name=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(c).name]])]),e("div",null,[r[19]||(r[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 用戶名 * ",-1)),y(e("input",{"onUpdate:modelValue":r[9]||(r[9]=t=>a(c).username=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(c).username]])]),e("div",null,[r[20]||(r[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Email * ",-1)),y(e("input",{"onUpdate:modelValue":r[10]||(r[10]=t=>a(c).email=t),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(c).email]])]),e("div",null,[r[21]||(r[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 密碼 * ",-1)),y(e("input",{"onUpdate:modelValue":r[11]||(r[11]=t=>a(c).password=t),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(c).password]])]),e("div",null,[r[22]||(r[22]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 確認密碼 * ",-1)),y(e("input",{"onUpdate:modelValue":r[12]||(r[12]=t=>a(c).password_confirmation=t),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[f,a(c).password_confirmation]])]),e("div",null,[r[24]||(r[24]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 角色 ",-1)),y(e("select",{"onUpdate:modelValue":r[13]||(r[13]=t=>a(c).role=t),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},r[23]||(r[23]=[e("option",{value:"user"},"一般用戶",-1),e("option",{value:"admin"},"管理員",-1)]),512),[[A,a(c).role]])])]),e("div",dt,[e("button",{onClick:r[14]||(r[14]=t=>U.value=!1),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200"}," 取消 "),e("button",{onClick:O,class:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200"}," 建立 ")])])])):x("",!0)])}}};export{it as default};
